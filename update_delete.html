<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update and/or Delete</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <a href="read.html">Back to Read</a>
    <h1 id="nameText">No Batch Selected</h1>
    <p id="quantityAText">Beginning Inventory: N/A</p>
    <p id="dateAText">Expiration Date (Initial Inventory): N/A</p>
    <p id="quantityBText">Additional Inventory: N/A</p>
    <p id="dateBText">Expiration Date (Additional Inventory): N/A</p>
    <p id="quantityCText">Quantity Consumed: N/A</p>
    <p id="quantityDText">Ending Inventory: N/A</p>
    Beginning Inventory: <input type="number" id="quantityAInput"><br>
    Expiration Date (Initial Inventory): <input type="text" id="dateAInput"><br>
    Additional Inventory: <input type="number" id="quantityBInput"><br>
    Expiration Date (Additional Inventory): <input type="text" id="dateBInput"><br>
    Quantity Consumed: <input type="number" id="quantityCInput"><br>
    <button type="button" class="btn btn-primary" onclick="updateBatch()">Update Batch information</button>
    <button type="button" class="btn btn-danger" onclick="deleteBatch()">Delete Batch</button>
    <script>
        let database = JSON.parse(localStorage.getItem("2027_EMR")), id = -1
        function updateDetails() {
            let batch = database.batches[id]
            console.log(batch)
            $("#nameText")[0].innerText = batch.name
            $("#quantityAText")[0].innerText = "Beginning Inventory: " + batch.start
            $("#dateAText")[0].innerText = "Expiration Date (Initial Inventory): " + batch.expiryA
            $("#quantityBText")[0].innerText = "Additional Inventory: " + batch.added
            $("#dateBText")[0].innerText = "Expiration Date (Additional Inventory): " + (batch.expiryB ? batch.expiryB : "N/A")
            $("#quantityCText")[0].innerText = "Quantity Consumed: " + batch.consumed
            $("#quantityDText")[0].innerText = "Ending Inventory: " + batch.end
            $("#quantityAInput")[0].value = batch.start
            $("#dateAInput")[0].value = batch.expiryA
            $("#quantityBInput")[0].value = batch.added
            $("#dateBInput")[0].value = batch.expiryB
            $("#quantityCInput")[0].value = batch.consumed
        }
        function updateBatch() {
            if (id == -1) {
                return undefined
            }
            batch = database.batches[id]
            batch.start = Number($("#quantityAInput")[0].value)
            batch.expiryA = $("#dateAInput")[0].value
            batch.added = Number($("#quantityBInput")[0].value)
            batch.expiryB = $("#dateBInput")[0].value
            batch.consumed = Number($("#quantityCInput")[0].value)
            batch.end = batch.start + batch.added - batch.consumed
            updateDropdown()
            localStorage.setItem("2027_EMR", JSON.stringify(database))
        }
        function deleteBatch() {
            if (id == -1) {
                return undefined
            }
            database.batches.splice(id, 1)
            localStorage.setItem("2027_EMR", JSON.stringify(database))
            if (history.length > 1) { // needs slight rework
                history.back()
            } else {
                ;
            }
        }
        window.onload = function() {
            let url = document.location.href, params = url.split('?')[1].split('&'), data = {}, tmp
            for (let i = 0, l = params.length; i < l; i++) {
                tmp = params[i].split('=')
                data[tmp[0]] = tmp[1]
            }
            id = parseInt(data.id)
            updateDetails()
        }
    </script>
</body>
</html>