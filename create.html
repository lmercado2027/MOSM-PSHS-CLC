<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container-fluid" style="padding-top: 15px;">
        <div class="row">

            <div class="col-md-2">
                <button type="button" class="btn btn-primary left-align-button" onclick="goToLink('create')">Create</button>
                <br>
                <br>
                <button type="button" class="btn btn-primary left-align-button" onclick="goToLink('index')" style="width:90%;max-width: 128px;">Inventory</button>

                <br>
                <br>
            </div>

            <div class="col-md-8 rounded-background">
                <form onsubmit="return create()" action="index.html" method="post">
                    <nav class="navbar navbar-expand-md navbar-light">
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav mr-auto">
                            <li class="nav-item active">
                                <button type="button" class="btn btn-link-plain" onclick="goToLink('index')">back <span class="sr-only">(current)</span></button>
                            </li>

                            </ul>
                            <button type="submit" class="btn btn-primary">Create Batch</button>
                        </div>
                    </nav>

                    <br>
                        <label for="nameInput">Name:</label>
                        <input class="roundedInputBox" type="text" id="nameInput" name="nameInput" required><br><br>
                        <label for="quantityInput">Beginning Inventory:</label>
                        <input class="roundedInputBox" type="number" min="1" step="1" id="quantityInput" name="quantityInput" required><br><br>
                        <label for="dateInput">Expiration Date:</label> 
                        <input class="roundedInputBox" type="date" id="dateInput" name="dateInput" required><br><br>

                        <div class="d-md-none">
                            <br>
                            <button type="button" class="btn btn-link-plain" onclick="goToLink('index')">back <span class="sr-only">(current)</span></button>
                            &nbsp;&nbsp;
                            <button type="submit" class="btn btn-primary">Create Batch</button>
                            <br>
                            <br>
                        </div>
                </form>
            </div>
        </div>
    </div>









    <script>
        function goToLink(input){
            window.location.replace(input+".html");
        }

        let database = JSON.parse(localStorage.getItem("2027_EMR"))

        function create() {
            let name = $("#nameInput")[0].value
            for (let i = 0; i < database.batches.length; i++) {
                batch = database.batches[i]
                if (name == batch.name) {
                    alert("Item already exists. If this is intentional, please go to Home > Read > Update.")
                    return false
                } if (name < batch.name) {
                    database.batches.splice(i, 0, {
                        "name": name,
                        "start": Number($("#quantityInput")[0].value),
                        "expiryA": $("#dateInput")[0].value,
                        "added": 0,
                        "expiryB": "",
                        "consumed": 0,
                        "end": $("#quantityInput")[0].value
                    })
                    localStorage.setItem("2027_EMR", JSON.stringify(database))
                    return true
                }
            }

            database.batches.push({
                "name": name,
                "start": Number($("#quantityInput")[0].value),
                "expiryA": $("#dateInput")[0].value,
                "added": 0,
                "expiryB": "",
                "consumed": 0,
                "end": $("#quantityInput")[0].value
            })
            localStorage.setItem("2027_EMR", JSON.stringify(database))
            return true
        }
    </script>
</body>
</html>